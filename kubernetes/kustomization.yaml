apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: hoarder

secretGenerator:
- envs:
  - .env
  name: hoarder-secrets

images:
  - name: hoarder
    newTag: v0.21.0 # Specify the version here

configMapGenerator:
  - name: nextauth-configuration
    literals:
      - NEXTAUTH_URL=https://hoarder.example.com

patches:
  - target:
      kind: Ingress
      name: hoarder-web-ingress
    patch: |-
      - op: replace
        path: /spec/tls/0/hosts/0
        value: hoarder.example.com
      - op: replace
        path: /spec/tls/0/secretName
        value: tls-secret-name
      - op: replace
        path: /spec/rules/0/host
        value: hoarder.example.com

resources:
- namespace.yaml
- web-deployment.yaml
- web-service.yaml
- chrome-deployment.yaml
- chrome-service.yaml
- meilisearch-deployment.yaml
- meilisearch-service.yaml
- meilisearch-pvc.yaml
- data-pvc.yaml
- ingress.yaml
